<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>ORM/Data Access, the Right Way </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="ORM/Data Access, the Right Way ">
    <meta name="generator" content="docfx 2.43.2.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="orm_data_access_the_right_way">
<h1 id="ormdata-access-the-right-way">ORM/Data Access, the Right Way</h1>

<p>Every enterprise application is backed by a persistent data store, typically a relational database. Object-oriented programming (OOP), on the other hand, is the mainstream for enterprise application development. Great efforts of <a href="https://en.wikipedia.org/wiki/Object-relational_mapping">Object-Relational Mapping (ORM, O/RM, and O/R mapping tool)</a> have been made to reconcile these two, however it's still <a href="http://blogs.tedneward.com/post/the-vietnam-of-computer-science/">The Vietnam of Computer Science</a>, due to the misconceptions of SQL and OOP.</p>
<h2 id="the-misconceptions">The Misconceptions</h2>
<h3 id="sql-is-obsolete">SQL is Obsolete</h3>
<p>The origins of the SQL take us back to the 1970s. Since then, IT world changed, projects are much more complicated, but SQL stays - more or less - the same. It works, but it's not elegant for nowadays modern application development. Most ORM, like Entity Framework, tries to encapsulate the code needed to manipulate the data, so you don't use SQL anymore. Unfortunately, this is wrongheaded and will end up with <a href="https://en.wikipedia.org/wiki/Leaky_abstraction">Leaky Abstraction</a>.</p>
<p>As coined by <a href="https://en.wikipedia.org/wiki/Joel_Spolsky">Joel Spolsky</a>, the Law of Leaky Abstractions states: [<a href="https://en.wikipedia.org/wiki/Leaky_abstraction#cite_note-1">1</a>]</p>
<blockquote>
<p>All non-trivial abstractions, to some degree, are leaky.</p>
</blockquote>
<p>Apparently, RDBMS and SQL, being a fundamental of your application, is far from trivial. You can't expect to abstract it away - you have to live with it. ASP.Net web forms did similar thing, which tries to abstract server round trips away, now it's replaced with ASP.Net MVC/ASP.Net Core, which is back to the right track.</p>
<h3 id="ooppoco-obsession">OOP/POCO Obsession</h3>
<p>OOP, on the other hand, is modern and the mainstream of application development. It's so widely adopted by developers that many developers subconsciously believe OOP can solve all the problems. Moreover, many framework authors has the religion that any framework, if not support POCO, is not a good framework.</p>
<p>In fact, like any technology, OOP has its limitations too. The biggest one, IMO, is: <strong>OOP is limited to local process, it's not serialization/deserialization friendly.</strong> Each and every object is accessed via its reference (the address pointer), and the reference, together with the type metadata and compiled byte code (further reference to type descriptors, vtable, etc.), is private to local process. It's just too obvious to realize this.</p>
<p>By nature, any serialized data is value type, which means:</p>
<ol>
<li><p>To serialize/deserialize an object, a converter for the reference is needed, either implicitly or explicitly. JSON, the simplest data format for serialization/deserialization, is a great example.</p>
</li>
<li><p>As the object complexity grows, the complexity of the converter grows respectively. Particularly, the type metadata and compiled byte code, are extremely difficult for the conversion - in the end, you need virtually the whole type runtime. That's why so many applications start with <a href="https://martinfowler.com/tags/domain%20driven%20design.html">Domain Drive Design</a>, but end up with <a href="https://martinfowler.com/bliki/AnemicDomainModel.html">Anemic Domain Model</a>.</p>
</li>
<li><p>On the other hand, relational data is very complex by nature, compares to other data format such as JSON. This adds another complexity to the converter.</p>
</li>
</ol>
<p>That's the real problem of object-relational impedance mismatch, if you want to map between arbitrary objects (POCO) and relational data. Unfortunately, almost all ORMs are following this path, none of them can survive from this.</p>
<h2 id="the-right-way">The Right Way</h2>
<p>Once we make a step back, we can get a very simple solution. ORM/Data Access is a traditional problem, we can solve it in a traditional way.</p>
<h3 id="rich-metadata---relational-data-objects">Rich Metadata - Relational Data Objects</h3>
<p>Without the obsession of mapping between arbitrary objects and relational data, we can choose implementing relational schema and data into a comprehensive yet simple object model:</p>
<p><img src="/images/RdoDataArchitecture.jpg" alt="image"></p>
<p>Database and dataset schema is realized as concrete metadata objects, with rich set of properties, methods and events. SQL, serialization/deserialization are explicitly implemented in these objects. In the end:</p>
<ul>
<li>You're writing native SQL using C#/VB.Net, 100% strongly typed - unbeatable for both code maintainability and performance!</li>
<li>JSON serialization/deserialization is a first class citizen - unbeatable performance because no reflection required.</li>
<li>Database testing and deployment is a first class citizen. You can easily mock part of database with testing data, generate database from clean C#/VB.Net code, or generate C#/VB.Net code from table data in database, right in Visual Studio.</li>
<li>The rich metadata can be consumed conveniently by other layer of your application such as data presentation.</li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/DevZest/RDO.Net/blob/master/src/Docs/articles/overview/orm_data_access_the_right_way.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>Copyright © Weifen Luo | DevZest</span>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
